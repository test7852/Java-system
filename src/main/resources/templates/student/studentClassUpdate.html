<!DOCTYPE html>
<!--suppress ThymeleafVariablesResolveInspection-->
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title></title>
    <link rel="stylesheet" th:href="@{/layui/css/layui.css}" media="all" />
    <script th:src="@{/layui/layui.js}"></script>
    <script th:src="@{/js/register/jquery-3.1.0.min.js}"></script>
</head>
<style>
    .index{width: 520px;margin-left: 50px;}
    .layui-input{width: 120px;}
    .menu li{float: left;}
    .layui-form-label{margin-top: 15px}
    .layui-input{margin-top: 15px}
    button{margin-top: 70px;margin-left: 20px}
    ::-webkit-scrollbar {display:none}/*隐藏横向滚动条但可以滚动*/
</style>
<body>
<form class="layui-form" th:action="@{/studentClass/add}">
    <div class="index">
        <ul class="menu">
<!--            <li>-->
<!--                <label class="layui-form-label">分班编号：</label>-->
                <input  name="classid" th:value="${studentClass.classid}" type="hidden" required lay-verify="required" placeholder="分班编号" autocomplete="off" class="layui-input">
<!--            </li>-->
            <li>
                <label class="layui-form-label"> 班级编号：</label>
                <input  name="classno"  th:value="${studentClass.classno}"required lay-verify="required" placeholder="班级编号" autocomplete="off" class="layui-input">
            </li>
            <li>
                <label class="layui-form-label"> 班级名称：</label>
                <input  name="classname" th:value="${studentClass.classname}" required lay-verify="required" placeholder="班级名称" autocomplete="off" class="layui-input">
            </li>
            <li>
                <label class="layui-form-label"> 班级人数：</label>
                <input name="count" th:value="${studentClass.count}" required lay-verify="required" placeholder="班级人数" autocomplete="off" class="layui-input">
            </li>


            <li>
                <label class="layui-form-label"><i class="layui-icon">&#xe6b2;</i> 备注：</label>
                <input  name="remark" th:value="${studentClass.remark}" required lay-verify="required" placeholder="备注" autocomplete="off" class="layui-input">
            </li>
            <br>
            <li>
                <label ><i class="layui-icon">&#xe705;</i> 授课老师：</label>
                <select   name="teacher">
                    <option th:value="${teacher.emp_id}" th:text="${teacher.emp_name}"></option>
                    <option th:each="l:${lecturers}"th:value="${l.emp_id}" th:text="${l.emp_name}">部门</option>
                </select>
            </li>



            <li>
                <label><i class="layui-icon">&#xe705;</i> 班主任：</label>
                <select  name="classteacher">
                    <option th:value="${classTeacher.emp_id}" th:text="${classTeacher.emp_name}"></option>
                    <option th:each="c:${classTeachers}"th:value="${c.emp_id}" th:text="${c.emp_name}">部门</option>
                </select>
            </li>


            <li>
                <label><i class="layui-icon">&#xe705;</i> 所在系：</label>
                <select lay-filter="selectTheme" id="board" name="deptid">
                    <option th:value="${dept.deptid}" th:text="${dept.deptname}">请选择所在系</option>
                    <option th:each="e:${depts}"th:value="${e.deptid}" th:text="${e.deptname}">所在系</option>
                </select>
            </li>

            <li>
                <label ><i class="layui-icon">&#xe705;</i> 专业：</label>
                <select id="theme" name="majorid">
                    <option th:value="${major.majorid}" th:text="${major.majorname}"></option>
                </select>
            </li>

            <li>
                <label ><i class="layui-icon">&#xe663;</i> 届别</label>
                <select name="falled"  >
                    <option th:value="${studentfall.fallid}" th:text="${studentfall.level}" ></option>
                    <option th:each="c:${studentFalls}"th:value="${c.fallid}" th:text="${c.level}">部门</option>
                </select>

                <!--                    <input  name="majorid" required lay-verify="required" placeholder="专业" autocomplete="off" class="layui-input">-->
            </li>
        </ul>
        <button class="layui-btn layui-btn-radius layui-btn-normal" lay-submit lay-filter="formDemo">立即提交</button><!--测试提交值的时候把 lay-filter="formDemo"注释掉可直接提交-->
        <button type="reset" class="layui-btn layui-btn-radius layui-btn-warm">重新填写</button>
    </div>
</form>
</body>
<script type="text/javascript" th:inline="none">
    layui.use('form', function(){
        var form = layui.form;

        form.on('select(selectTheme)', function (data) {//对应lay-filter="selectTheme"
            var index1 = $('#board option:selected').val();//对应id="board"  得到一级菜单选中值的value
            var optionJson = [];
            $.ajax({
                url: "/studentClass/byDeptId",//对应controller层
                type: "post",
                data: {"id": index1},//将选中值的value传给controller
                datatype: "json",
                success: function (data) {
                    optionJson = data;
                    var selectObj = document.getElementById("theme");//对应id="theme"
                    selectObj.options.length = 0;
                    for (var i = 0; i < data.length; i++) {
                        selectObj.add(new Option(optionJson[i].majorname, optionJson[i].majorid));//对应数据库中名字，两个参数是(文本,value)
                    }
                    form.render();
                }
            })
        });

        //监听提交
        //你可以在这里做操作  也可以不使用这个方法
        form.on('submit(formDemo)', function(data){
            $.ajax({
                url: '/studentClass/update',
                type: 'post',
                data:data.field,
                dataType: 'json',
                success:function(data){
                    if(data != 0){
                        //先得到当前iframe层的索引
                        var index = parent.layer.getFrameIndex(window.name);
                        //再执行关闭
                        parent.layer.close(index);
                        layer.msg(JSON.stringify("修改成功"));
                        window.parent.location.reload();
                    }else {
                        layer.msg('数据错误，修改失败！', { icon: 5, time: 2000 });
                    }
                },
            })
            return false;
        });
    });
</script>
</html>